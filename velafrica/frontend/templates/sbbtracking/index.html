{% extends "base.html" %}
{% load staticfiles %}

{% block breadcrumb %} 
<li><a href="{% url 'tracking' %}">Velo Tracking</a></li>
{% endblock %} 

{% block document-head %}

{% endblock %}

{% block jumbotron-img %}{% endblock %}
{% block jumbotron-title %}
Velo Tracking
{% endblock %}

{% block jumbotron_id %}velotracking{% endblock %}

{% block jumbotron %}

<div class="row">
	<div class="col-lg-6">
		<form action="/tracking/" method="POST">
			{% csrf_token %}
			<div class="input-group">
			      <input type="text" name="tracking_no" class="form-control" placeholder="Tracking Nummer" value="{% if tno %}{{tno}}{%endif%}">
			      <span class="input-group-btn">
			        <input class="btn btn-primary" type="submit" value="Go!"/>
			      </span>
			</div><!-- /input-group -->
		</form>
	</div>
</div>

{% endblock %}

{% block content %}
{% if tracking %}
	<h2>Tracking Infos f&uuml;r Velo {{ tracking.tracking_no }}</h2>
	{% if tracking.vpn %}
	<p>Verarbeitungspartner: {% if tracking.vpn.website %}<a href="{{ tracking.vpn.website }}" target="_blank">{{ tracking.vpn }}</a>{% else %}{{ tracking.vpn }}{% endif %}</p>
	{% endif %}
	{% if tracking.destination %}
	<p>Destination: {% if tracking.destination.website %}<a href="{{ tracking.destination.website }}" target="_blank">{{ tracking.destination }}</a>{% else %}{{ tracking.destination }}{% endif %}</p>
	{% endif %}
	{% if tracking.completed %}
	<div class="label label-success">Velo in Afrika angekommen.</div>
	{% elif tracking.ready_for_export %}
	<div class="label label-warning">Velo bereit f&uuml;r Export</div>
	{% endif %}

	<h3>History</h3>
	{% for te in tracking_events %}
	<!-- Modal -->
	<div class="modal fade" id="tracking_event_{{ te.id }}" tabindex="-1" role="dialog" aria-labelledby="{{ te.event_type}}">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="tracking_event_{{ te.id }}_label">{{ te.event_type }}</h4>
	      </div>
	      {% if te.event_type.image %}
	      <div class="modal-body modal-header-img" style="background-image: url(' {{ te.event_type.image.url }}');">
	      </div>
	      {% endif %}
	      <div class="modal-body">

	        {{ te.event_type.description }}
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>
	{% endfor %}
	<table class="table">
		<thead>
			<tr>
				<th>Datum</th>
				<th>Zeit</th>
				<th>Ereignis</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
	{% for te in tracking_events %}
		<tr>
			<td>{{ te.datetime | date:"d.m.Y" }}</td>
			<td>{{ te.datetime | date:"H:m" }}</td>
			<td>{{ te.event_type }}</td>
			<td><a href="#" data-toggle="modal" data-target="#tracking_event_{{te.id}}"><span class="big-glyphicon glyphicon glyphicon-info-sign"></span></a></td>
	{% endfor %}
		</tbody>
	</table>
{% else %}
 {% if messages %}
	{% for message in messages %}
	<div class="alert alert-danger">{{ message }}</div>
	{% endfor %}
  {% endif %}

{% endif %}

{% endblock %}

{% block document-foot %}

{% endblock %}